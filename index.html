<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>3段スライド背景 Ver.15.4</title>
<style>
html, body { margin:0; padding:0; }
body { padding:20px; }

.bg {
  position: fixed;
  inset: 0;
  z-index: -1;
  background-color: #6b76ae;
  pointer-events: none;
  overflow: hidden;
  --row-height: 33.333vh;
}

.row {
  position: absolute;
  left:0; right:0;
  height: var(--row-height);
  overflow: hidden;
}

.row1 { top:0; }
.row2 { top: var(--row-height); }
.row3 { top: calc(var(--row-height)*2); }

.belt {
  display: flex;
  align-items: center;
  gap: 0;
  will-change: transform;
}

/* 中段のみ右詰め */
.row2 .belt {
  justify-content: flex-end;
}

.belt img {
  height: 99%;
  width: auto;
  display: block;
  object-fit: contain;
}

main { position: relative; z-index:1; }
</style>
</head>
<body>

<div class="bg" aria-hidden="true">

  <!-- 1段目 -->
  <div class="row row1">
    <div class="belt js-loop" data-dir="left">
      <img src="assets/row1/1.png" alt="Image 1">
      <img src="assets/row1/2.png" alt="Image 2">
      <img src="assets/row1/3.png" alt="Image 3">
      <img src="assets/row1/4.png" alt="Image 4">
      <img src="assets/row1/5.png" alt="Image 5">
    </div>
  </div>

  <!-- 2段目（右詰め） -->
  <div class="row row2">
    <div class="belt js-loop" data-dir="right">
      <img src="assets/row2/6.png" alt="Image 6">
      <img src="assets/row2/7.png" alt="Image 7">
      <img src="assets/row2/8.png" alt="Image 8">
      <img src="assets/row2/9.png" alt="Image 9">
      <img src="assets/row2/10.png" alt="Image 10">
    </div>
  </div>

  <!-- 3段目 -->
  <div class="row row3">
    <div class="belt js-loop" data-dir="left">
      <img src="assets/row3/11.png" alt="Image 11">
      <img src="assets/row3/12.png" alt="Image 12">
      <img src="assets/row3/13.png" alt="Image 13">
      <img src="assets/row3/14.png" alt="Image 14">
      <img src="assets/row3/15.png" alt="Image 15">
    </div>
  </div>

</div>

<main>
  <h1>メッセージ Ver.15.4</h1>
  <p>中段速度修正済み・全段無限ループ・40秒1周</p>
</main>

<script>
// 画像高さを段の99%に統一
function updateImageSize() {
  document.querySelectorAll('.js-loop').forEach(belt => {
    const row = belt.parentElement;
    const rowHeight = row.clientHeight;
    belt.querySelectorAll('img').forEach(img => {
      img.style.height = rowHeight * 0.99 + 'px';
    });
  });
}
updateImageSize();
window.addEventListener('resize', updateImageSize);

// 無限ループ処理（複製後も速度一定）
document.querySelectorAll('.js-loop').forEach(belt => {
  const dir = belt.dataset.dir === 'right' ? 1 : -1;
  const duration = 40 * 1000; // 40秒で1周

  // 複製前のHTML上1周幅を取得
  const images = Array.from(belt.querySelectorAll('img'));
  const originalWidth = images.reduce((sum, img) => sum + img.offsetWidth, 0);

  // 横幅が画面幅の2倍以上になるまで複製
  while (belt.scrollWidth < window.innerWidth * 2) {
    belt.innerHTML += belt.innerHTML;
  }

  const loop = () => {
    const t = (performance.now() % duration) / duration;
    const x = t * originalWidth * dir; // 複製前の幅で移動距離計算
    belt.style.transform = `translateX(${x}px)`;
    requestAnimationFrame(loop);
  };
  loop();
});
</script>

</body>
</html>
